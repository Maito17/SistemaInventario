<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Factura #{{ venta.id_venta }}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            font-size: 12px;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 850px;
            margin: 0 auto;
            padding: 20px;
            border: 1px solid #999;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #000;
            padding-bottom: 20px;
        }
        
        .company-info h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .company-info p {
            font-size: 10px;
            margin: 2px 0;
        }
        
        .factura-info {
            text-align: right;
        }
        
        .factura-info h2 {
            font-size: 18px;
            margin-bottom: 5px;
            border: 2px solid #000;
            padding: 10px;
        }
        
        .factura-info p {
            font-size: 11px;
            margin: 3px 0;
        }
        
        .section-title {
            font-weight: bold;
            font-size: 12px;
            margin-top: 15px;
            margin-bottom: 5px;
            background-color: #f0f0f0;
            padding: 5px;
            border-left: 3px solid #000;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .info-column {
            font-size: 11px;
        }
        
        .info-column p {
            margin: 3px 0;
        }
        
        .info-column strong {
            display: block;
            margin-top: 8px;
            margin-bottom: 2px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        table thead {
            background-color: #f0f0f0;
            border-top: 2px solid #000;
            border-bottom: 2px solid #000;
        }
        
        table th {
            padding: 8px;
            text-align: left;
            font-weight: bold;
            font-size: 11px;
        }
        
        table td {
            padding: 8px;
            font-size: 11px;
            border-bottom: 1px solid #ddd;
        }
        
        table td.text-right {
            text-align: right;
        }
        
        table td.text-center {
            text-align: center;
        }
        
        .totals-section {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 2px solid #000;
        }
        
        .totals-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        .totals-table td {
            padding: 8px;
            border: none;
            font-size: 12px;
        }
        
        .totals-table .label {
            text-align: right;
            font-weight: bold;
        }
        
        .totals-table .amount {
            text-align: right;
            min-width: 100px;
        }
        
        .grand-total {
            background-color: #f0f0f0;
            border: 2px solid #000;
            padding: 12px;
            font-size: 14px;
            font-weight: bold;
            text-align: right;
            margin: 15px 0;
        }
        
        .observations {
            font-size: 10px;
            margin-top: 15px;
            padding: 10px;
            background-color: #fff9e6;
            border-left: 3px solid #ffcc00;
        }
        
        .footer {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px dashed #999;
            text-align: center;
            font-size: 10px;
            color: #666;
        }
        
        .signature-section {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-top: 40px;
            text-align: center;
        }
        
        .signature-line {
            border-top: 1px solid #000;
            padding-top: 30px;
            font-size: 10px;
        }
        
        @media print {
            body {
                margin: 0;
                padding: 0;
            }
            .container {
                border: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ENCABEZADO -->
        <div class="header">
            <div class="company-info">
                {% if config_empresa and config_empresa.logo %}
                    <img src="{{ config_empresa.logo.url }}" alt="Logo" style="max-width: 100px; max-height: 50px; margin-bottom: 10px;">
                {% endif %}
                <h1>{{ config_empresa.nombre_empresa|default:"EMPRESA" }}</h1>
                <p><strong>RUC:</strong> {{ config_empresa.ruc|default:"0123456789001" }}</p>
                {% if config_empresa.direccion %}
                    <p><strong>Dirección:</strong> {{ config_empresa.direccion }}</p>
                {% endif %}
                {% if config_empresa.telefono_celular or config_empresa.telefono_convencional %}
                    <p><strong>Teléfono:</strong> 
                    {% if config_empresa.telefono_celular %}{{ config_empresa.telefono_celular }}{% endif %}
                    {% if config_empresa.telefono_convencional %} / {{ config_empresa.telefono_convencional }}{% endif %}
                    </p>
                {% endif %}
                {% if config_empresa.email %}
                    <p><strong>Email:</strong> {{ config_empresa.email }}</p>
                {% endif %}
                {% if config_empresa.sitio_web %}
                    <p><strong>Sitio Web:</strong> {{ config_empresa.sitio_web }}</p>
                {% endif %}
            </div>
            <div class="factura-info">
                <h2>FACTURA</h2>
                <p><strong>Número:</strong> {{ venta.id_venta }}</p>
                <p><strong>Fecha:</strong> {{ venta.fecha_venta|date:"d/m/Y" }}</p>
                <p><strong>Hora:</strong> {{ venta.fecha_venta|date:"H:i" }}</p>
            </div>
        </div>

        <!-- INFORMACIÓN DEL CLIENTE -->
        <div class="section-title">INFORMACIÓN DEL CLIENTE</div>
        <div class="info-grid">
            <div class="info-column">
                {% if venta.cliente %}
                    <p><strong>Cliente:</strong></p>
                    <p>{{ venta.cliente.nombre }} {{ venta.cliente.apellido }}</p>
                    <p><strong>RUC/Cédula:</strong> {{ venta.cliente.id_cliente }}</p>
                    <p><strong>Email:</strong> {{ venta.cliente.email|default:"N/A" }}</p>
                {% else %}
                    <p><strong>Cliente:</strong> Consumidor Final</p>
                {% endif %}
            </div>
            <div class="info-column">
                <p><strong>Vendedor:</strong> {{ venta.antendido_por.get_full_name|default:venta.antendido_por.username }}</p>
                <p><strong>Fecha de Emisión:</strong> {{ venta.fecha_venta|date:"d/m/Y H:i" }}</p>
                <p><strong>Método de Pago:</strong> {{ venta.get_metodo_pago_display|default:"Efectivo" }}</p>
            </div>
        </div>

        <!-- DETALLE DE PRODUCTOS -->
        <div class="section-title">DETALLE DE PRODUCTOS</div>
        <table>
            <thead>
                <tr>
                    <th style="width: 40%;">Descripción del Producto</th>
                    <th style="width: 15%; text-align: center;">Cantidad</th>
                    <th style="width: 15%; text-align: right;">P. Unitario</th>
                    <th style="width: 15%; text-align: right;">Descuento</th>
                    <th style="width: 15%; text-align: right;">Subtotal</th>
                </tr>
            </thead>
            <tbody>
                {% for detalle in venta.detalles.all %}
                <tr>
                    <td>{{ detalle.producto.nombre }}</td>
                    <td class="text-center">{{ detalle.cantidad }}</td>
                    <td class="text-right">${{ detalle.precio_unitario|floatformat:2 }}</td>
                    <td class="text-right">$0.00</td>
                    <td class="text-right">${{ detalle.subtotal|floatformat:2 }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- TOTALES -->
        <div class=\"totals-section\">
            <table class=\"totals-table\">
                <tr>
                    <td class=\"label\">Subtotal (sin IVA):</td>
                    <td class=\"amount\">${{ subtotal|floatformat:2 }}</td>
                </tr>
                <tr>
                    <td class=\"label\">
                        {% if venta.detalles.count > 0 %}
                            <!-- Obtener tarifa IVA del primer producto (asumiendo que todos usan el mismo) -->
                            {% with tarifa=venta.detalles.first.producto.tarifa_iva|default:15 %}
                                IVA ({{ tarifa }}%):
                            {% endwith %}
                        {% else %}
                            IVA (15%):
                        {% endif %}
                    </td>
                    <td class=\"amount\">${{ iva|floatformat:2 }}</td>
                </tr>
            </table>
            
            <div class="grand-total">
                TOTAL A PAGAR: ${{ venta.total|floatformat:2 }}
            </div>
        </div>

        <!-- OBSERVACIONES -->
        <div class="observations">
            <strong>Observaciones:</strong>
            <p>Esta es una factura electrónica válida. La información aquí contenida es correcta según los registros de nuestra empresa.</p>
        </div>

        <!-- FIRMAS -->
        <div class="signature-section">
            <div class="signature-line">
                Firma Vendedor<br>
                {{ venta.antendido_por.username }}
            </div>
            <div class="signature-line">
                Firma Cliente
            </div>
            <div class="signature-line">
                Autorizado por SRI
            </div>
        </div>

        <!-- PIE DE PÁGINA -->
        <div class="footer">
            <p>Esta factura fue generada electrónicamente el {{ venta.fecha_venta|date:"d/m/Y H:i" }}</p>
            {% if config_empresa and config_empresa.email %}
                <p>Para consultas o reclamos comunicarse al email: {{ config_empresa.email }}</p>
            {% endif %}
            <p>Gracias por su compra</p>
        </div>
    </div>

    <script>
        // Auto-imprimir al cargar
        window.onload = function() {
            window.print();
        };
    </script>
</body>
</html>
